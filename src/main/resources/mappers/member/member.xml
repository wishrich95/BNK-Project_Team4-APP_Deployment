<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.busanbank.mapper.MemberMapper">

    <insert id="insertUser" parameterType="kr.co.busanbank.dto.UsersDTO">
        INSERT INTO USERS(
        userno, username, userid, userpw, email, hp, zip, addr1, addr2, regdate, createdat,
        updatedat, accountpassword, rrn, onceLimit, dailyLimit
        ) VALUES (
        #{userNo},
        #{userName},
        #{userId},
        #{userPw},
        #{email,jdbcType=VARCHAR},
        #{hp, jdbcType=VARCHAR},
        #{zip,jdbcType=VARCHAR},
        #{addr1,jdbcType=VARCHAR},
        #{addr2,jdbcType=VARCHAR},
        SYSDATE,
        SYSDATE,
        SYSDATE,
        #{accountPassword,jdbcType=VARCHAR},
        #{rrn,jdbcType=VARCHAR},
        #{onceLimit,jdbcType=NUMERIC},<!-- 2025/12/29 - íšŒì›ê°€ìž… ì‹œ ì´ì²´í•œë„ ì¶”ê°€ - ìž‘ì„±ìž: ì˜¤ì„œì • -->
        #{dailyLimit,jdbcType=NUMERIC}
        )
    </insert>

    <update id="updatePw">
        UPDATE users
        SET userPw = #{encodedPass}
        WHERE userId = #{userId}
    </update>

    <select id="findByUserId" parameterType="string" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT * FROM USERS WHERE userId = #{userId}
    </select>

    <!-- 2025/12/18 - userNoë¡œ ì‚¬ìš©ìž ì •ë³´ ì¡°íšŒ - ìž‘ì„±ìž: ì§„ì› -->
    <select id="findByUserNo" parameterType="long" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT * FROM USERS WHERE userNo = #{userNo}
    </select>

    <!-- 2025/11/30 - íšŒì› ìƒíƒœ ì²˜ë¦¬(A:í™œì„± ê²½ìš°ë§Œ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ê°€ëŠ¥ - ì˜¤ì„œì • -->
    <select id="findUserIdInfoEmail" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT userId, userName, email FROM USERS WHERE userName = #{userName} AND email = #{email} and status = 'A'
    </select>

    <select id="findUserIdInfoHp" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT userId, userName, hp FROM USERS WHERE userName = #{userName} AND hp = #{hp} and status = 'A'
    </select>

    <select id="findUserPwInfoEmail" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT userId, userName, email FROM USERS WHERE userName = #{userName} AND email = #{email} AND userId= #{userId} and status = 'A'
    </select>

    <select id="findUserPwInfoHp" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT userId, name, hp FROM USERS WHERE userName = #{userName} AND hp = #{hp} AND userId= #{userId} and status = 'A'
    </select>


    <select id="countByUserId" parameterType="string" resultType="int">
        SELECT COUNT(*) FROM USERS WHERE userId = #{userId}
    </select>

    <select id="countByEmail" parameterType="string" resultType="int">
        SELECT COUNT(*) FROM USERS WHERE email = #{email}
    </select>

    <select id="countByHp" parameterType="string" resultType="int">
        SELECT COUNT(*) FROM USERS WHERE hp = #{hp}
    </select>


    <select id="getTermsAll" resultType="kr.co.busanbank.dto.TermDTO">
        select termno, termtype, termtitle, termcontent
        from term
    </select>

    <!-- /////////////////////////////////////////////////////////////// -->
    <!-- ê³„ì¢Œì•”í˜¸í™” ë¹„êµë¥¼ ìœ„í•œ ì¿¼ë¦¬ - â˜…â˜…â˜… 2025/12/11 ìˆ˜ì§„ â˜…â˜…â˜… -->
    <select id="findAccountPasswordByUserId" resultType="String">
        SELECT accountPassword
        FROM USERS
        WHERE userId = #{userId}
    </select>

    <!-- ðŸ”¥ userIdë¡œ userNo ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ - â˜…â˜…â˜… 2025/12/11 ìˆ˜ì§„ â˜…â˜…â˜… -->
    <select id="findUserNoByUserId" resultType="long">
        SELECT userNo
        FROM USERS
        WHERE userId = #{userId}
    </select>

    <!-- â˜… ê³„ì¢Œë¹„ë²ˆ ì¿¼ë¦¬  -->
    <select id="findAccountPasswordByUserNo" resultType="String">
        SELECT accountPassword
        FROM USERS
        WHERE userNo = #{userNo}
    </select>
    <!-- /////////////////////////////////////////////////////////////// -->

    <!-- 2025/12/05 - ì¸ì¦ ê´€ë ¨ ë¡œì§ ìˆ˜ì • - ìž‘ì„±ìž: ì˜¤ì„œì •-->
    <select id="selectAllEmails" resultType="string">
        SELECT email FROM USERS WHERE email IS NOT NULL
    </select>

    <select id="selectAllHps" resultType="string">
        SELECT hp FROM USERS WHERE hp IS NOT NULL
    </select>

    <select id="selectAllUserNames" resultType="string">
        SELECT userName FROM USERS WHERE userName IS NOT NULL
    </select>

    <select id="selectAllForIdFind" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT userId, userName, hp, email, status
        FROM USERS
        WHERE status = 'A'
    </select>

    <select id="selectAllForPwFind" resultType="kr.co.busanbank.dto.UsersDTO">
        SELECT userId, userName, email, hp, status
        FROM USERS
        WHERE status = 'A'
    </select>

    <!-- 2025/12/23 - ë‹‰ë„¤ìž„ ë° ì•„ë°”íƒ€ ê´€ë ¨ ì¿¼ë¦¬ ì¶”ê°€ - ìž‘ì„±ìž: ì§„ì› -->

    <!-- ë‹‰ë„¤ìž„ ì¤‘ë³µ í™•ì¸ -->
    <select id="countByNickname" resultType="int">
        SELECT COUNT(*)
        FROM USERS
        WHERE nickname = #{nickname}
        AND status = 'A'
    </select>

    <!-- ë‹‰ë„¤ìž„ ì—…ë°ì´íŠ¸ -->
    <update id="updateNickname">
        UPDATE USERS
        SET nickname = #{nickname},
            updatedat = SYSDATE
        WHERE userno = #{userNo}
    </update>

    <!-- ì•„ë°”íƒ€ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ -->
    <update id="updateAvatarImage">
        UPDATE USERS
        SET avatarimage = #{avatarImage},
            updatedat = SYSDATE
        WHERE userno = #{userNo}
    </update>

</mapper>