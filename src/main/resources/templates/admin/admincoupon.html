<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>딸깍은행::쿠폰 관리</title>

    <link rel="stylesheet" th:href="@{/css/admin/admin_category.css}">
    <link rel="stylesheet" th:href="@{/css/admin/admin_productList.css}">
    <link rel="stylesheet" th:href="@{/css/common/style_font.css}">

    <script th:src="@{/js/admin/admin_category.js}" defer></script>
    <script th:src="@{/js/admin/admin_coupon.js}" defer></script>

</head>
<body>
<div class="container" style="display:flex;">
    <div th:replace="~{admin/_adminSidebar :: sidebar}"></div>

    <div class="main-right">
        <div class="productList_title">
            <span class="title_sp">쿠폰 관리</span>
            <div style="display: flex; gap: 10px; align-items: center;">
                <select id="statusFilter" style="height: 45px; width: 100px; padding: 0px 10px; font-size: 18px;">
                    <option value="">전체 상태</option>
                    <option value="Y">활성</option>
                    <option value="N">비활성</option>
                </select>
                <input type="text" id="searchInput" placeholder="쿠폰명 또는 코드 검색"
                       style="height: 45px; width: 200px; padding: 10px; font-size: 18px;">
                <button onclick="searchCoupons()" class="title_btn">검색</button>
                <button onclick="openAddModal()" class="title_btn">쿠폰 등록</button>
            </div>
        </div>

        <table>
            <thead>
            <tr style="background-color: #E1545A;color:white;">
                <th style="border-radius: 5px 0 0 0; width: 8%;">번호</th>
                <th style="width: 15%;">쿠폰 코드</th>
                <th style="width: 20%;">쿠폰명</th>
                <th style="width: 10%;">금리(%p)</th>
                <th style="width: 12%;">사용현황</th>
                <th style="width: 20%;">유효기간</th>
                <th style="width: 8%;">상태</th>
                <th style="border-radius: 0 5px 0 0; width: 7%;">관리</th>
            </tr>
            </thead>
            <tbody id="couponTableBody">
            <tr>
                <td colspan="8" style="text-align:center; padding: 20px;">로딩 중...</td>
            </tr>
            </tbody>
        </table>

        <div class="page_div">
            <ul class="pagenation" id="pagination">
            </ul>
        </div>
    </div>
</div>

<!-- 쿠폰 등록/수정 모달 -->
<div id="couponModal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow-y: auto;">
    <div style="position: relative; background-color: white; margin: 2% auto; padding: 30px; border: 1px solid #888; border-radius: 10px; width: 700px; max-width: 90%;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #E1545A; padding-bottom: 10px;">
            <h2 id="modalTitle" style="margin: 0; color: #E1545A;">쿠폰 등록</h2>
            <span onclick="closeModal()" style="cursor: pointer; font-size: 28px; font-weight: bold; color: #aaa;">&times;</span>
        </div>

        <form id="couponForm">
            <input type="hidden" id="couponId">

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">쿠폰 코드 <span style="color: red;">*</span></label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="couponCode" name="couponCode" required maxlength="50" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <button type="button" onclick="checkDuplicate()" style="padding: 8px 15px; background-color: #E1545A; color: white; border: none; border-radius: 4px; cursor: pointer;">중복확인</button>
                </div>
                <div id="codeValidation" style="font-size: 12px; margin-top: 5px;"></div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">쿠폰명 <span style="color: red;">*</span></label>
                <input type="text" id="couponName" name="couponName" required maxlength="200" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">쿠폰 설명</label>
                <textarea id="description" name="description" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; resize: vertical;"></textarea>
            </div>

            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">금리 인상률 (%p) <span style="color: red;">*</span></label>
                    <input type="number" id="rateIncrease" name="rateIncrease" required step="0.01" min="0" max="100" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">최대 발급 수량 (0=무제한)</label>
                    <input type="number" id="maxUsageCount" name="maxUsageCount" value="0" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">유효기간 시작 <span style="color: red;">*</span></label>
                    <input type="date" id="validFrom" name="validFrom" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">유효기간 종료 <span style="color: red;">*</span></label>
                    <input type="date" id="validTo" name="validTo" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">적용 카테고리 <span style="color: red;">*</span></label>
                <div id="categoryCheckboxes" style="display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" id="isActive" name="isActive" checked>
                    <span style="font-weight: bold; color: #333;">활성화</span>
                </label>
            </div>

            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button type="button" id="deleteBtn" onclick="deleteCoupon()" style="padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; display: none;">삭제</button>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="closeModal()" style="padding: 10px 20px; background-color: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">취소</button>
                    <button type="button" onclick="saveCoupon()" style="padding: 10px 20px; background-color: #E1545A; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">저장</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    window.categoriesData = /*[[${categories}]]*/ [];
    /*]]>*/
</script>
</body>
</html>
