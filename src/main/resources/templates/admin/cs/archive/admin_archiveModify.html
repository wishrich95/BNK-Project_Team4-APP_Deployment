<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë”¸ê¹ì€í–‰::ì„œì‹/ì•½ê´€/ìë£Œì‹¤ ìˆ˜ì •</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin_category.css}">
    <link rel="stylesheet" th:href="@{/css/admin/admin_reportModify.css}">
    <link rel="stylesheet" th:href="@{/css/common/style_font.css}"> <!-- ê³µìš© í°íŠ¸ -->
    <script th:src="@{/js/admin/admin_category.js}"></script>
    <script>
        function deleteImage() {
            const imageDiv = document.getElementById('img_div');
            imageDiv.innerHTML = "";
        }

        document.addEventListener('DOMContentLoaded', () => {
            // íŒŒì¼ ì—…ë¡œë“œ
            const fileInput = document.getElementById('uploadFile');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const fileRemove = document.getElementById('fileRemove');

            fileInput.addEventListener('change', handleFileSelect);
            fileRemove.addEventListener('click', removeFile);

            if(filePreview.classList.contains('active')) {
                fileUploadArea.style.display = 'none';
            }

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileSelect();
                }
            });

            function handleFileSelect() {
                const file = fileInput.files[0];
                if (file) {
                    // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        alert('íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        fileInput.value = '';
                        return;
                    }

                    // ì´ë¯¸ì§€ ë˜ëŠ” PDF íŒŒì¼ë§Œ í—ˆìš©
                    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
                    if (!allowedTypes.includes(file.type)) {
                        alert('ì´ë¯¸ì§€ íŒŒì¼ ë˜ëŠ” PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                        fileInput.value = '';
                        return;
                    }

                    fileName.textContent = file.name;
                    fileSize.textContent = formatFileSize(file.size);
                    filePreview.classList.add('active');
                    fileUploadArea.style.display = 'none';
                }
            }

            function removeFile() {
                fileInput.value = '';
                filePreview.classList.remove('active');
                fileUploadArea.style.display = 'block';
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
            }
        });
    </script>
</head>
<body>
<div class="container" style="display: flex;">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” - Fragment ì‚¬ìš© -->
    <div th:replace="~{admin/_adminSidebar :: sidebar}"></div>

    <div class="main-right">
        <div class="faq_title">
            <span class="title_sp">ì„œì‹/ì•½ê´€/ìë£Œì‹¤ ìˆ˜ì •</span>
        </div>

        <form th:action="@{/admin/archive/modify}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="id" th:value="${csPDFDTO.id}">
            <div class="form-group">
                <label class="form-label">ìœ í˜•</label>
                <select name="archiveCategory" style="appearance: none;">
                    <option>ì„ íƒ</option>
                    <option th:selected="${csPDFDTO.archiveCategory == '01'}" th:value="'01'">ìƒí’ˆì•½ê´€</option>
                    <option th:selected="${csPDFDTO.archiveCategory == '02'}" th:value="'02'">ìƒí’ˆì„¤ëª…ì„œ</option>
                    <option th:selected="${csPDFDTO.archiveCategory == '03'}" th:value="'03'">ì„œì‹ìë£Œì‹¤</option>
                </select>
                <input type="hidden" name="groupCode" id="groupCode" value="ARCHIVE_TYPE">
            </div>
            <div class="form-group">
                <label class="form-label">ì œëª©</label>
                <input
                    type="text" name="title"
                    class="form-input" placeholder="ì´ë²¤íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    maxlength="100" th:value="${csPDFDTO.title}">
            </div>

            <div class="form-group">
                <label class="form-label">
                    ì²¨ë¶€ ì´ë¯¸ì§€
                </label>
                <p class="form-description">ì´ë²¤íŠ¸ ë°°ë„ˆ ë˜ëŠ” ìƒì„¸ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš” (ìµœëŒ€ 10MB)</p>

                <div class="file-upload-wrapper">
                    <label for="uploadFile" class="file-upload-area" id="fileUploadArea" th:classappend="${csPDFDTO.file} != null ? 'hidden' : ''">
                        <div class="file-upload-icon">ğŸ“</div>
                        <div class="file-upload-text">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                        <div class="file-upload-hint">JPG, PNG, GIF (ìµœëŒ€ 10MB)</div>
                    </label>
                    <input type="file" name="uploadFile" id="uploadFile" accept="application/pdf" th:src="${csPDFDTO.file}">

                    <div class="file-preview" id="filePreview" th:classappend="${csPDFDTO.file} != null ? 'active' : ''">
                        <div class="file-info">
                            <div class="file-name" id="fileName" th:text="${csPDFDTO.file}"></div>
                            <div class="file-size" id="fileSize" th:text="${csPDFDTO.fileSize}"></div>
                        </div>
                        <button type="button" class="file-remove" id="fileRemove">âœ•</button>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-cancel" onclick="history.back()">ì·¨ì†Œí•˜ê¸°</button>
                <button type="submit" class="btn btn-submit">ë“±ë¡í•˜ê¸°</button>
            </div>
        </form>
    </div>
</div>
</body>
</html>