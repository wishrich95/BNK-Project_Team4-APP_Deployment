<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë”¸ê¹ì€í–‰::ë¹„íŠ¸ì½”ì¸, ê¸ˆ, ì˜¤ì¼ ì‹œì„¸ í™•ì¸</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin_category.css}">
    <link rel="stylesheet" th:href="@{/css/common/style_font.css}">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        .main-right {
            background: linear-gradient(135deg, #FFF5F5 0%, #FFE9EA 50%, #FFF0F1 100%);
            left: 360px;
            min-height: 100vh;
            opacity: 1;
            padding: 40px;
            top: 0px;
            width: 1560px;
        }

        /* í˜ì´ì§€ íƒ€ì´í‹€ */
        .page-title {
            color: #E1545A;
            font-family: 'Pretendard', sans-serif;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
            padding-left: 10px;
            border-left: 4px solid #E1545A;
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ê·¸ë¦¬ë“œ */
        .charts-container {
            display: grid;
            gap: 30px;
            grid-template-columns: 1fr;
        }

        /* ê°œë³„ ì°¨íŠ¸ ì¹´ë“œ */
        .chart-card {
            background: #FFFFFF;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(225, 84, 90, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            box-shadow: 0 15px 50px rgba(225, 84, 90, 0.2);
            transform: translateY(-5px);
        }

        /* ì°¨íŠ¸ í—¤ë” */
        .chart-header {
            align-items: center;
            background: linear-gradient(90deg, #E1545A 0%, #FF7B7B 100%);
            display: flex;
            gap: 15px;
            padding: 20px 30px;
        }

        .chart-icon {
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            font-size: 24px;
            height: 50px;
            justify-content: center;
            width: 50px;
        }

        .chart-title-wrapper {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .chart-title {
            color: #FFFFFF;
            font-family: 'Pretendard', sans-serif;
            font-size: 20px;
            font-weight: 600;
        }

        .chart-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-family: 'Pretendard', sans-serif;
            font-size: 13px;
            font-weight: 400;
        }

        /* ì°¨íŠ¸ ë°”ë”” */
        .chart-body {
            padding: 25px;
        }

        .chart-div {
            background: #FAFAFA;
            border: 1px solid #F0F0F0;
            border-radius: 12px;
            height: 350px;
            width: 100%;
        }

        /* 2ì—´ ë ˆì´ì•„ì›ƒ (ê¸ˆ, ì˜¤ì¼) */
        .charts-row {
            display: grid;
            gap: 30px;
            grid-template-columns: repeat(2, 1fr);
        }

        .charts-row .chart-card {
            width: 100%;
        }

        .charts-row .chart-div {
            height: 300px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1400px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script th:src="@{/js/admin/admin_category.js}"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script>
        const chartConfig = {
            displayModeBar: false,
            displaylogo: false,
            modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
            responsive: true
        };

        async function drawCoinChart() {
            const response = await fetch(`/busanbank/api/coin/history/btc?symbol=BTC`);
            const json = await response.json();
            console.log(json);
            const x = json.map(item => item.createdAt);
            const y = json.map(item => Number(item.price));
            const yDisplay = y.map(p => p.toFixed(2));

            const trace = {
                x,
                y: yDisplay,
                mode: 'lines',
                name: 'BTC',
                line: {
                    color: '#2C3E50',
                    width: 3,
                    shape: 'spline'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(44, 62, 80, 0.1)'
            };

            const minY = Math.min(...y) * 0.995;
            const maxY = Math.max(...y) * 1.005;

            const layout = {
                margin: { t: 20, r: 30, b: 50, l: 70 },
                xaxis: {
                    title: 'ì‹œê°„',
                    gridcolor: '#F0F0F0',
                    linecolor: '#E0E0E0',
                    dtick: 86400000,
                },
                yaxis: {
                    title: 'ê°€ê²© (USD)',
                    gridcolor: '#F0F0F0',
                    linecolor: '#E0E0E0',
                    tickformat: ',.0f',
                    range: [minY, maxY],
                    nticks: 5
                },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { family: 'Pretendard, sans-serif', color: '#666' },
                hovermode: 'x unified'
            };

            Plotly.newPlot('coinChartDiv', [trace], layout, chartConfig);
        }

        async function drawGoldChart() {
            const response = await fetch(`/busanbank/api/coin/history/gold?symbol=XAU`);
            const json = await response.json();

            const x = json.map(item => item.createdAt);
            const y = json.map(item => Number(item.price));
            const yDisplay = y.map(p => p.toFixed(2));

            const trace = {
                x,
                y: yDisplay,
                mode: 'lines',
                name: 'XAU',
                line: {
                    color: '#FFD700',
                    width: 3,
                    shape: 'spline'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(255, 215, 0, 0.15)'
            };

            const minY = Math.min(...y) * 0.995;
            const maxY = Math.max(...y) * 1.005;

            const layout = {
                margin: { t: 20, r: 30, b: 50, l: 70 },
                xaxis: {
                    title: 'ì‹œê°„',
                    gridcolor: '#F0F0F0',
                    linecolor: '#E0E0E0',
                    dtick: 86400000
                },
                yaxis: {
                    title: 'ê°€ê²© (USD)',
                    gridcolor: '#F0F0F0',
                    linecolor: '#E0E0E0',
                    tickformat: ',.0f',
                    range: [minY, maxY],
                    nticks: 5
                },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { family: 'Pretendard, sans-serif', color: '#666' },
                hovermode: 'x unified'
            };

            Plotly.newPlot('metalChartDiv', [trace], layout, chartConfig);
        }

        async function drawOilChart() {
            const response = await fetch(`/busanbank/api/coin/history/oil?symbol=OIL`);
            const json = await response.json();

            const x = json.map(item => item.createdAt);
            const y = json.map(item => Number(item.price));
            const yDisplay = y.map(p => p.toFixed(2));

            const trace = {
                x,
                y: yDisplay,
                mode: 'lines',
                name: 'OIL',
                line: {
                    color: '#667EEA',
                    width: 3,
                    shape: 'spline'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(102, 126, 234, 0.1)'
            };

            const minY = Math.min(...y) * 0.995;
            const maxY = Math.max(...y) * 1.005;

            const layout = {
                margin: { t: 20, r: 30, b: 50, l: 70 },
                xaxis: {
                    title: 'ì‹œê°„',
                    gridcolor: '#F0F0F0',
                    linecolor: '#E0E0E0',
                    dtick: 86400000
                },
                yaxis: {
                    title: 'ê°€ê²© (USD)',
                    gridcolor: '#F0F0F0',
                    linecolor: '#E0E0E0',
                    tickformat: ',.2f',
                    range: [minY, maxY],
                    nticks: 5
                },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { family: 'Pretendard, sans-serif', color: '#666' },
                hovermode: 'x unified'
            };

            Plotly.newPlot('oilChartDiv', [trace], layout, chartConfig);
        }

        window.onload = () => {
            drawCoinChart();
            drawGoldChart();
            drawOilChart();
        };
    </script>
</head>
<body>
<div class="container" style="display: flex;">
    <div th:replace="~{admin/_adminSidebar :: sidebar}"></div>

    <div class="main-right">
        <h1 class="page-title">ì‹¤ì‹œê°„ ì‹œì„¸ í˜„í™©</h1>

        <div class="charts-container">
            <!-- ë¹„íŠ¸ì½”ì¸ ì°¨íŠ¸ (ì „ì²´ ë„ˆë¹„) -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-icon">â‚¿</div>
                    <div class="chart-title-wrapper">
                        <span class="chart-title">ë¹„íŠ¸ì½”ì¸ (BTC)</span>
                        <span class="chart-subtitle">Bitcoin Real-time Price</span>
                    </div>
                </div>
                <div class="chart-body">
                    <div id="coinChartDiv" class="chart-div"></div>
                </div>
            </div>

            <!-- ê¸ˆ, ì˜¤ì¼ ì°¨íŠ¸ (2ì—´) -->
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-icon">ğŸ¥‡</div>
                        <div class="chart-title-wrapper">
                            <span class="chart-title">ê¸ˆ (XAU)</span>
                            <span class="chart-subtitle">Gold Real-time Price</span>
                        </div>
                    </div>
                    <div class="chart-body">
                        <div id="metalChartDiv" class="chart-div"></div>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-icon">ğŸ›¢ï¸</div>
                        <div class="chart-title-wrapper">
                            <span class="chart-title">ì›ìœ  (OIL)</span>
                            <span class="chart-subtitle">Oil Real-time Price</span>
                        </div>
                    </div>
                    <div class="chart-body">
                        <div id="oilChartDiv" class="chart-div"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>