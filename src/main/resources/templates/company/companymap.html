<!DOCTYPE html>
<html lang="ko">
<!--
    ì‘ì„±ì: ì§„ì›
    ì‘ì„±ì¼: 2025-11-24
    ì„¤ëª…: ì€í–‰ì†Œê°œ - ì˜ì—…ì ì•ˆë‚´ í˜ì´ì§€ (ì¹´ì¹´ì˜¤ë§µ API ì‚¬ìš©)
-->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>ë”¸ê¹ì€í–‰::ì˜ì—…ì ì•ˆë‚´</title>

    <!-- ê¸°ì¡´ í”„ë¡œì íŠ¸ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" th:href="@{/css/common/style_common.css}">
    <link rel="stylesheet" th:href="@{/css/common/style_font.css}">
    <link href="//cdn.jsdelivr.net/xeicon/2/xeicon.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/_header.css}">
    <link rel="stylesheet" th:href="@{/css/_footer.css}">
    <link rel="stylesheet" th:href="@{/css/member/AutoLogout.css}">

    <script th:src="@{/js/gnbDropdown.js}" defer></script>
    <script th:src="@{/js/translate.js}" defer></script>
    <script th:src="@{/js/globalBtn.js}" defer></script>
    <script th:src="@{/js/searchOverlay.js}" defer></script>
    <script th:src="@{/js/member/session-timer.js}" defer></script>

    <style>
        /* ===== ë¦¬ì…‹ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: auto;
        }

        body {
            font-family: 'Segoe UI', 'Noto Sans KR', sans-serif;
            color: #333;
            background-color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            border: none;
            background: none;
            cursor: pointer;
            font-family: inherit;
        }

        /* ===== ìƒ‰ìƒ ë³€ìˆ˜ ===== */
        :root {
            --primary-dark: #D03238;
            --primary-light: #E1545A;
            --secondary-light: #FFE9EA;
            --secondary-mid: #FFB9BD;
        }

        /* ===== MAIN ===== */
        main {
            min-height: calc(100vh - 300px);
            padding: 40px 0;
        }

        .page-header {
            border-bottom: 3px solid var(--primary-dark);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .page-header .subtitle {
            font-size: 13px;
            color: #666;
        }

        /* ===== TAB ===== */
        .tab-menu {
            display: flex;
            gap: 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 12px 20px;
            background-color: #f9f9f9;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background-color: #f0f0f0;
        }

        .tab-btn.active {
            background-color: var(--primary-dark);
            color: #fff;
            border-bottom-color: var(--primary-dark);
        }

        /* ===== SEARCH ===== */
        .search-section {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
        }

        .search-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fff;
            cursor: pointer;
            min-width: 150px;
        }

        .search-btn {
            padding: 10px 30px;
            background-color: var(--primary-dark);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-btn:hover {
            background-color: #b71c1c;
        }

        /* ===== CONTENT ===== */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            min-height: 600px;
        }

        .branch-list-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .branch-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            max-height: 600px;
        }

        .branch-list::-webkit-scrollbar {
            width: 8px;
        }

        .branch-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .branch-list::-webkit-scrollbar-thumb {
            background: var(--primary-dark);
            border-radius: 4px;
        }

        /* ===== BRANCH ITEM ===== */
        .branch-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .branch-item:hover {
            border-color: var(--primary-dark);
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(208, 50, 56, 0.15);
        }

        .branch-item.active {
            border-color: var(--primary-dark);
            background-color: var(--secondary-light);
            box-shadow: 0 2px 8px rgba(208, 50, 56, 0.2);
        }

        .branch-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .branch-name {
            font-size: 15px;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .tag-safebox {
            background-color: var(--primary-dark);
            color: white;
            padding: 3px 8px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 3px;
            white-space: nowrap;
        }

        .branch-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .branch-detail {
            font-size: 12px;
        }

        .branch-detail.full-width {
            grid-column: 1 / -1;
        }

        .branch-detail .label {
            display: block;
            color: #999;
            font-size: 11px;
            margin-bottom: 3px;
            font-weight: 500;
        }

        .branch-detail .value {
            display: block;
            color: #333;
            font-size: 12px;
            font-weight: 500;
        }

        .branch-footer {
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .branch-footer .phone {
            font-size: 12px;
            color: var(--primary-dark);
            font-weight: 600;
        }

        /* ===== PAGINATION ===== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            padding: 15px 0;
            border-top: 1px solid #eee;
        }

        .page-btn {
            padding: 8px 12px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .page-btn:hover:not(:disabled) {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-numbers {
            display: flex;
            gap: 5px;
        }

        .page-num {
            padding: 6px 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .page-num:hover {
            background-color: #e0e0e0;
        }

        .page-num.active {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }

        /* ===== MAP ===== */
        .map-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-controls {
            display: flex;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .map-btn {
            padding: 8px 15px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .map-btn:hover {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #ddd;
            background: #e0e0e0;
        }

        .map-info {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background-color: #fafafa;
            min-height: 120px;
        }

        .info-content {
            font-size: 13px;
            line-height: 1.6;
            color: #666;
        }

        .info-content .info-title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-content .info-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .info-content .info-item:last-child {
            border-bottom: none;
        }

        .info-content .info-label {
            font-weight: 500;
            color: #999;
            min-width: 60px;
        }

        .info-content .info-value {
            color: #333;
            font-weight: 500;
        }

        .info-content .info-value.highlight {
            color: var(--primary-dark);
            font-weight: 600;
        }

        .error {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 4px;
            padding: 15px;
            color: #c62828;
            margin: 20px 0;
            text-align: center;
            font-size: 13px;
        }

        /* ===== ë°˜ì‘í˜• ===== */
        @media (max-width: 1024px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }

            .map-container {
                height: 350px;
            }
        }

        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 22px;
            }

            .tab-btn {
                padding: 10px 15px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .page-header h1 {
                font-size: 18px;
            }

            .search-select,
            .search-btn {
                flex: 1;
                min-width: 100px;
            }

            .branch-info {
                grid-template-columns: 1fr;
            }

            .map-container {
                height: 250px;
            }
        }
    </style>
</head>

<body th:classappend="${#authorization.expr('isAuthenticated()')} ? 'logged-in' : ''">
<!-- Header ë¶€ë¶„ -->
<header th:replace="~{_header :: headerFragment}"></header>

<!-- MAIN CONTENT -->
<main>
    <div class="container">
        <div class="page-header">
            <h1>ì˜ì—…ì ì•ˆë‚´</h1>
            <p class="subtitle">ê°€ê¹Œìš´ ê³³ì—ì„œ ê³ ê°ë‹˜ì„ ê¸°ë‹¤ë¦¬ê² ìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tab-menu">
            <button class="tab-btn active" data-tab="branch">ì˜ì—…ì </button>
            <button class="tab-btn" data-tab="corner365">365ì½”ë„ˆ</button>
            <button class="tab-btn" data-tab="corner24">24/365ì½”ë„ˆ</button>
            <button class="tab-btn" data-tab="overseas">í•´ì™¸ì§€ì </button>
            <button class="tab-btn" data-tab="safebox">ëŒ€ì—¬ê¸ˆê³ </button>
            <button class="tab-btn" data-tab="lotteatm">ë¡¯ë°ATM</button>
            <button class="tab-btn" data-tab="stm">STM</button>
            <button class="tab-btn" data-tab="foreignatm">ì™¸êµ­ATM</button>
        </div>

        <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="search-section">
            <div class="search-container">
                <select id="districtSelect" class="search-select">
                    <option value="">ì„ íƒ</option>
                    <option value="jung">ì¤‘êµ¬</option>
                    <option value="seo">ì„œêµ¬</option>
                    <option value="dong">ë™êµ¬</option>
                    <option value="yeongdo">ì˜ë„êµ¬</option>
                    <option value="busanjin">ë¶€ì‚°ì§„êµ¬</option>
                    <option value="dongrae">ë™ë˜êµ¬</option>
                    <option value="haeundae">í•´ìš´ëŒ€êµ¬</option>
                    <option value="suyeong">ìˆ˜ì˜êµ¬</option>
                    <option value="nam">ë‚¨êµ¬</option>
                    <option value="buk">ë¶êµ¬</option>
                    <option value="gangseo">ê°•ì„œêµ¬</option>
                    <option value="geumjeong">ê¸ˆì •êµ¬</option>
                    <option value="sasang">ì‚¬ìƒêµ¬</option>
                    <option value="gijang">ê¸°ì¥êµ°</option>
                </select>
                <button id="searchBtn" class="search-btn">ê²€ìƒ‰</button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="content-wrapper">
            <!-- ì¢Œì¸¡: ì§€ì  ëª©ë¡ -->
            <div class="branch-list-section">
                <div id="branchList" class="branch-list"></div>
                <div class="pagination">
                    <button class="page-btn" id="prevBtn">ì´ì „</button>
                    <div id="pageNumbers" class="page-numbers"></div>
                    <button class="page-btn" id="nextBtn">ë‹¤ìŒ</button>
                </div>
            </div>

            <!-- ìš°ì¸¡: ì§€ë„ -->
            <div class="map-section">
                <div class="map-controls">
                    <button id="skySkyViewBtn" class="map-btn">ìœ„ì„±ë·°</button>
                </div>
                <div id="map" class="map-container"></div>
                <div class="map-info">
                    <div id="mapInfoContent" class="info-content">
                        <p>ì§€ì ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- FOOTER -->
<footer>
    <section class="footer">
        <div class="container">
            <div class="f-link">
                <a href="#" class="link-active">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                <a href="#">ê³ ê°ì •ë³´ì·¨ê¸‰ë°©ì¹¨</a>
                <a href="#">ê²½ì˜ê³µì‹œ</a>
            </div>
            <div class="f-number">
                ê³ ê°ì„¼í„°<strong>1588-6200, 1544-6200</strong>
            </div>
            <div class="f-copy">COPYTRIGHT Â© 2014 BUSANBANK. ALL RIGHTS RESERVED.</div>
            <button id="topBtn" class="top-btn" aria-label="ë§¨ ìœ„ë¡œ ì´ë™">â†‘</button>
        </div>
    </section>
</footer>

<!-- ì¹´ì¹´ì˜¤ë§µ API (âœ… autoload=false ì„¤ì •) -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fcb02db403a511ea44eb59837485cda6&libraries=services,clusterer,drawing&autoload=false"></script>

<!-- ì˜ì—…ì  ì•ˆë‚´ JavaScript -->
<script th:inline="javascript">
    console.log('ğŸ”§ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹œì‘');

    class BranchInfoManager {
        constructor() {
            this.currentPage = 1;
            this.itemsPerPage = 10;
            this.allBranches = [];
            this.filteredBranches = [];
            this.map = null;
            this.markers = [];
            this.infoWindows = [];
            this.selectedBranchId = null;
            this.currentTab = 'branch';
            this.isMapMode = true;

            this.init();
        }

        init() {
            this.setupEventListeners();
            this.loadSampleData();
            this.initializeKakaoMap();
            this.setupTopButton();
        }

        setupEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => this.handleTabChange(e));
            });

            document.getElementById('searchBtn').addEventListener('click', () => this.handleSearch());
            document.getElementById('districtSelect').addEventListener('change', () => this.handleSearch());

            document.getElementById('prevBtn').addEventListener('click', () => this.prevPage());
            document.getElementById('nextBtn').addEventListener('click', () => this.nextPage());

            document.addEventListener('click', (e) => {
                if (e.target.closest('.branch-item')) {
                    const item = e.target.closest('.branch-item');
                    this.selectBranch(item);
                }
            });

            document.getElementById('skySkyViewBtn').addEventListener('click', () => this.toggleView());
        }

        initializeKakaoMap() {
            console.log('ğŸ—ºï¸ ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');

            if (typeof kakao === 'undefined' || !kakao.maps) {
                console.error('âŒ ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            // âœ… kakao.maps.load() ì½œë°± ì‚¬ìš© (autoload=falseì™€ í•¨ê»˜)
            kakao.maps.load(() => {
                console.log('âœ… ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì™„ë£Œ!');

                const mapContainer = document.getElementById('map');
                const mapOptions = {
                    center: new kakao.maps.LatLng(35.1796, 129.0756), // ë¶€ì‚° ì‹œì²­
                    level: 8
                };

                try {
                    this.map = new kakao.maps.Map(mapContainer, mapOptions);
                    console.log('âœ… ì§€ë„ ìƒì„± ì„±ê³µ');

                    kakao.maps.event.addListener(this.map, 'click', () => {
                        this.closeAllInfoWindows();
                    });

                    // í˜„ì¬ í˜ì´ì§€ ì§€ì ë“¤ì˜ ë§ˆì»¤ í‘œì‹œ
                    this.renderMapMarkers();

                } catch (error) {
                    console.error('âŒ ì§€ë„ ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
                }
            });
        }

        /**
         * ì‘ì„±ì: ì§„ì›
         * ì‘ì„±ì¼: 2025-11-29
         * ì„¤ëª…: ì„œë²„ì—ì„œ ì§€ì  ë°ì´í„° ë¡œë“œ (Thymeleafë¡œ ì£¼ì…ë°›ì€ ë°ì´í„° ì‚¬ìš©)
         */
        loadSampleData() {
            // Thymeleafì—ì„œ ì£¼ì…ë°›ì€ ë°ì´í„°ë¥¼ JavaScriptë¡œ ë³€í™˜
            /*[# th:if="${branches != null}"]*/
            const serverBranches = [[${branches}]];
            /*[/]*/
            /*[# th:unless="${branches != null}"]*/
            const serverBranches = [];
            /*[/]*/

            console.log('ì„œë²„ì—ì„œ ë°›ì€ ì›ë³¸ ë°ì´í„°:', serverBranches);

            // ê¸°ë³¸ ì¢Œí‘œ (ë¶€ì‚° ì§€ì—­ì˜ ëŒ€ëµì ì¸ ì¢Œí‘œ)
            const defaultCoordinates = [
                { lat: 35.0982, lng: 129.0338 },  // ì¤‘êµ¬
                { lat: 35.1549, lng: 129.0626 },  // ë¶€ì‚°ì§„êµ¬
                { lat: 35.1606, lng: 129.1618 },  // í•´ìš´ëŒ€êµ¬
                { lat: 35.1532, lng: 129.1189 },  // ìˆ˜ì˜êµ¬
                { lat: 35.0952, lng: 129.0350 }   // ì¤‘êµ¬ ë‚¨í¬ë™
            ];

            // ì„œë²„ ë°ì´í„°ë¥¼ JavaScript ê°ì²´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            const branchData = serverBranches.map((branch, index) => ({
                id: branch.branchId,
                name: branch.branchName,
                branchCode: branch.branchCode,
                address: branch.address,
                phone: branch.tel,
                fax: branch.fax || '-',
                openDate: branch.openDate || '1968-02-01',
                // ìœ„ë„/ê²½ë„ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
                latitude: branch.latitude || (defaultCoordinates[index % defaultCoordinates.length].lat),
                longitude: branch.longitude || (defaultCoordinates[index % defaultCoordinates.length].lng),
                has365Corner: branch.has365Corner === 'Y',
                hasForeignExchange: branch.hasForeignExchange === 'Y',
                hasSafebox: branch.hasSafebox === 'Y',
                hasNightSafebox: branch.hasNightSafebox === 'Y'
            }));

            console.log('ë³€í™˜ëœ ì§€ì  ë°ì´í„°:', branchData);

            // ê° íƒ­ë³„ë¡œ ë°ì´í„° í•„í„°ë§
            const dataByTab = {
                branch: branchData, // ëª¨ë“  ì˜ì—…ì 
                corner365: branchData.filter(b => b.has365Corner), // 365ì½”ë„ˆê°€ ìˆëŠ” ì§€ì 
                corner24: branchData.filter(b => b.hasNightSafebox), // 24/365ì½”ë„ˆ (ì•¼ê°„ê¸ˆê³ ê°€ ìˆëŠ” ì§€ì )
                overseas: [], // í•´ì™¸ì§€ì ì€ í˜„ì¬ ë°ì´í„° ì—†ìŒ
                safebox: branchData.filter(b => b.hasSafebox), // ëŒ€ì—¬ê¸ˆê³ ê°€ ìˆëŠ” ì§€ì 
                lotteatm: [], // ë¡¯ë°ATMì€ ë³„ë„ ë°ì´í„° í•„ìš”
                stm: [], // STMì€ ë³„ë„ ë°ì´í„° í•„ìš”
                foreignatm: branchData.filter(b => b.hasForeignExchange) // ì™¸êµ­í™˜ ì·¨ê¸‰ ì§€ì 
            };

            this.allBranches = dataByTab[this.currentTab] || [];
            this.filteredBranches = [...this.allBranches];

            console.log('í˜„ì¬ íƒ­ì˜ ì§€ì  ìˆ˜:', this.allBranches.length);

            this.renderBranchList();
            this.renderPagination();
        }

        handleTabChange(e) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            e.target.classList.add('active');
            this.currentTab = e.target.dataset.tab;
            this.currentPage = 1;
            this.selectedBranchId = null;
            document.getElementById('mapInfoContent').innerHTML = '<p>ì§€ì ì„ ì„ íƒí•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
            this.loadSampleData();
        }

        handleSearch() {
            const district = document.getElementById('districtSelect').value;

            if (district === '') {
                this.filteredBranches = [...this.allBranches];
            } else {
                this.filteredBranches = this.allBranches.filter(branch =>
                    this.getDistrictFromAddress(branch.address) === district
                );
            }

            this.currentPage = 1;
            this.renderBranchList();
            this.renderPagination();
        }

        getDistrictFromAddress(address) {
            const districts = {
                'ì¤‘êµ¬': 'jung', 'ì„œêµ¬': 'seo', 'ë™êµ¬': 'dong', 'ì˜ë„êµ¬': 'yeongdo',
                'ë¶€ì‚°ì§„êµ¬': 'busanjin', 'ë™ë˜êµ¬': 'dongrae', 'í•´ìš´ëŒ€êµ¬': 'haeundae', 'ìˆ˜ì˜êµ¬': 'suyeong',
                'ë‚¨êµ¬': 'nam', 'ë¶êµ¬': 'buk', 'ê°•ì„œêµ¬': 'gangseo', 'ê¸ˆì •êµ¬': 'geumjeong',
                'ì‚¬ìƒêµ¬': 'sasang', 'ê¸°ì¥êµ°': 'gijang'
            };

            for (let [key, value] of Object.entries(districts)) {
                if (address.includes(key)) {
                    return value;
                }
            }
            return '';
        }

        renderBranchList() {
            const branchList = document.getElementById('branchList');
            const start = (this.currentPage - 1) * this.itemsPerPage;
            const end = start + this.itemsPerPage;
            const pageBranches = this.filteredBranches.slice(start, end);

            if (pageBranches.length === 0) {
                branchList.innerHTML = '<div class="error">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            branchList.innerHTML = pageBranches.map((branch, index) => `
                    <div class="branch-item" data-id="${branch.id}">
                        <div class="branch-header">
                            <h3 class="branch-name">${start + index + 1}. ${branch.name}</h3>
                            ${branch.hasSafebox ? '<span class="tag-safebox">ëŒ€ì—¬ê¸ˆê³ </span>' : ''}
                        </div>
                        <div class="branch-info">
                            <div class="branch-detail">
                                <span class="label">ì§€ì ì½”ë“œ</span>
                                <span class="value">${branch.branchCode}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ê°œì ì¼</span>
                                <span class="value">${branch.openDate}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ëŒ€ê¸°ê³ ê°</span>
                                <span class="value">${Math.floor(Math.random() * 20) + 1}ëª…</span>
                            </div>
                        </div>
                        <div class="branch-detail full-width">
                            <span class="label">ì£¼ì†Œ</span>
                            <span class="value">${branch.address}</span>
                        </div>
                        <div class="branch-info">
                            <div class="branch-detail">
                                <span class="label">365ì½”ë„ˆ</span>
                                <span class="value">${branch.has365Corner ? 'â—¯' : 'âœ•'}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ì™¸êµ­í™˜</span>
                                <span class="value">${branch.hasForeignExchange ? 'â—¯' : 'âœ•'}</span>
                            </div>
                            <div class="branch-detail">
                                <span class="label">ì•¼ê°„ê¸ˆê³ </span>
                                <span class="value">${branch.hasNightSafebox ? 'â—¯' : 'âœ•'}</span>
                            </div>
                        </div>
                        <div class="branch-footer">
                            <span class="phone">${branch.phone}</span>
                        </div>
                    </div>
                `).join('');

            // ì§€ë„ì— í˜„ì¬ í˜ì´ì§€ì˜ ë§ˆì»¤ í‘œì‹œ
            this.renderMapMarkers();
        }

        renderMapMarkers() {
            if (!this.map) {
                console.log('âš ï¸ ì§€ë„ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            this.markers.forEach(marker => marker.setMap(null));
            this.markers = [];

            const start = (this.currentPage - 1) * this.itemsPerPage;
            const end = start + this.itemsPerPage;
            const pageBranches = this.filteredBranches.slice(start, end);

            if (pageBranches.length === 0) {
                return;
            }

            const bounds = new kakao.maps.LatLngBounds();

            pageBranches.forEach(branch => {
                const position = new kakao.maps.LatLng(branch.latitude, branch.longitude);
                bounds.extend(position);

                const marker = new kakao.maps.Marker({
                    map: this.map,
                    position: position,
                    title: branch.name
                });

                // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                kakao.maps.event.addListener(marker, 'click', () => {
                    console.log('ë§ˆì»¤ í´ë¦­:', branch.name);

                    // í•´ë‹¹ ì§€ì ì˜ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    this.showBranchInfo(branch);

                    // ì§€ë„ ì¤‘ì‹¬ì„ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
                    this.map.panTo(position);

                    // ë¦¬ìŠ¤íŠ¸ì—ì„œë„ í•´ë‹¹ ì§€ì ì„ í™œì„±í™”
                    const branchItem = document.querySelector(`.branch-item[data-id="${branch.id}"]`);
                    if (branchItem) {
                        document.querySelectorAll('.branch-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        branchItem.classList.add('active');

                        // í•´ë‹¹ í•­ëª©ì´ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
                        branchItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                });

                this.markers.push(marker);
            });

            if (pageBranches.length > 0) {
                this.map.setBounds(bounds);
            }
        }

        renderPagination() {
            const totalPages = Math.ceil(this.filteredBranches.length / this.itemsPerPage);
            const pageNumbers = document.getElementById('pageNumbers');

            pageNumbers.innerHTML = '';

            let startPage = Math.max(1, this.currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);

            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-num ${i === this.currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => this.goToPage(i));
                pageNumbers.appendChild(pageBtn);
            }

            document.getElementById('prevBtn').disabled = this.currentPage === 1;
            document.getElementById('nextBtn').disabled = this.currentPage === totalPages;
        }

        prevPage() {
            if (this.currentPage > 1) {
                this.currentPage--;
                this.renderBranchList();
                this.renderPagination();
            }
        }

        nextPage() {
            const totalPages = Math.ceil(this.filteredBranches.length / this.itemsPerPage);
            if (this.currentPage < totalPages) {
                this.currentPage++;
                this.renderBranchList();
                this.renderPagination();
            }
        }

        goToPage(pageNum) {
            this.currentPage = pageNum;
            this.renderBranchList();
            this.renderPagination();
        }

        selectBranch(element) {
            document.querySelectorAll('.branch-item').forEach(item => {
                item.classList.remove('active');
            });

            element.classList.add('active');

            const branchId = element.dataset.id;
            const branch = this.allBranches.find(b => b.id == branchId);

            if (branch) {
                this.selectedBranchId = branchId;
                this.showBranchInfo(branch);

                // ì§€ë„ ì¤‘ì‹¬ì„ ì„ íƒí•œ ì§€ì ìœ¼ë¡œ ì´ë™
                if (this.map) {
                    const position = new kakao.maps.LatLng(branch.latitude, branch.longitude);
                    this.map.panTo(position);
                }
            }
        }

        showBranchInfo(branch) {
            const mapInfoContent = document.getElementById('mapInfoContent');
            mapInfoContent.innerHTML = `
                    <div class="info-content">
                        <div class="info-title">${branch.name}</div>
                        <div class="info-item">
                            <span class="info-label">ì§€ì ì½”ë“œ</span>
                            <span class="info-value">${branch.branchCode}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ì „í™”</span>
                            <span class="info-value highlight">${branch.phone}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">íŒ©ìŠ¤</span>
                            <span class="info-value">${branch.fax || '-'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ì£¼ì†Œ</span>
                            <span class="info-value">${branch.address}</span>
                        </div>
                    </div>
                `;
        }

        toggleView() {
            const btn = document.getElementById('skySkyViewBtn');
            if (!this.map) return;

            if (this.isMapMode) {
                this.map.setMapTypeId(kakao.maps.MapTypeId.HYBRID);
                btn.textContent = 'ì§€ë„ë³´ê¸°';
                this.isMapMode = false;
            } else {
                this.map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
                btn.textContent = 'ìœ„ì„±ë·°';
                this.isMapMode = true;
            }
        }

        closeAllInfoWindows() {
            this.infoWindows.forEach(infoWindow => {
                infoWindow.close();
            });
            this.infoWindows = [];
        }

        setupTopButton() {
            const topBtn = document.getElementById('topBtn');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    topBtn.classList.add('show');
                } else {
                    topBtn.classList.remove('show');
                }
            });

            topBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸ“„ DOM ë¡œë“œ ì™„ë£Œ, BranchInfoManager ì´ˆê¸°í™”');
        window.branchManager = new BranchInfoManager();
    });
</script>
</body>
</html>